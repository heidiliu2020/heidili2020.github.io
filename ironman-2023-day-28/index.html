<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4274798044223706"
      crossorigin="anonymous"></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/apple-icon.png" color="#222">
  <link rel="manifest" href="/images/manifest.json">
  <meta name="msapplication-config" content="/images/browserconfig.xml">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"heidiliu2020.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":true,"sidebar":{"position":"right","Pisces | Gemini":200,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="原文連結：今さら聞けないログの基本と設計指針 - Qiita  在進行程式開發時，不論是前後端，應該都對 Log（日誌）再熟悉不過。尤其是在遇到非預期性的錯誤時，通常會需要立即調閱 Log，查看是否顯示錯誤訊息；或是在改良軟體時，需要透過 Log 來分析使用者行為等等。 接下來這篇文章，將會針對 Log（日誌）主題進行介紹，從 Log 相關的基礎知識、設計方法、操作時的注意事項，再到實際應用說明">
<meta property="og:type" content="article">
<meta property="og:title" content="[2023 15th鐵人賽] Day28 - 事到如今問不出口的 Log 基礎和設計指南">
<meta property="og:url" content="https://heidiliu2020.github.io/ironman-2023-day-28/index.html">
<meta property="og:site_name" content="前端新米">
<meta property="og:description" content="原文連結：今さら聞けないログの基本と設計指針 - Qiita  在進行程式開發時，不論是前後端，應該都對 Log（日誌）再熟悉不過。尤其是在遇到非預期性的錯誤時，通常會需要立即調閱 Log，查看是否顯示錯誤訊息；或是在改良軟體時，需要透過 Log 來分析使用者行為等等。 接下來這篇文章，將會針對 Log（日誌）主題進行介紹，從 Log 相關的基礎知識、設計方法、操作時的注意事項，再到實際應用說明">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://hackmd.io/_uploads/rJGyp9rZT.png">
<meta property="article:published_time" content="2023-10-13T00:46:01.000Z">
<meta property="article:modified_time" content="2023-10-13T00:49:16.744Z">
<meta property="article:author" content="Heidi Liu">
<meta property="article:tag" content="Back-End">
<meta property="article:tag" content="ironman2023">
<meta property="article:tag" content="Qiita">
<meta property="article:tag" content="Log">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/rJGyp9rZT.png">

<link rel="canonical" href="https://heidiliu2020.github.io/ironman-2023-day-28/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>[2023 15th鐵人賽] Day28 - 事到如今問不出口的 Log 基礎和設計指南 | 前端新米</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6F0SL2XTQY"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-6F0SL2XTQY');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">前端新米</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Heidi's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-首頁">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-文章分類">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>文章分類</a>

  </li>
        <li class="menu-item menu-item-文章列表">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章列表</a>

  </li>
        <li class="menu-item menu-item-關於我">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>關於我</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://heidiliu2020.github.io/ironman-2023-day-28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/65410665?s=460&u=887bd602944dcf78b90f3a880b03aec4e086728a&v=4">
      <meta itemprop="name" content="Heidi Liu">
      <meta itemprop="description" content="海底修羅場｜日々進化中">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端新米">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [2023 15th鐵人賽] Day28 - 事到如今問不出口的 Log 基礎和設計指南
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>
              

              <time title="創建時間：2023-10-13 08:46:01 / 修改時間：08:49:16" itemprop="dateCreated datePublished" datetime="2023-10-13T08:46:01+08:00">2023-10-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/2023%E9%90%B5%E4%BA%BA%E8%B3%BD/" itemprop="url" rel="index"><span itemprop="name">2023鐵人賽</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/2023%E9%90%B5%E4%BA%BA%E8%B3%BD/Back-End/" itemprop="url" rel="index"><span itemprop="name">Back-End</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="文章字數">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>8.2k</span>
            </span>
            <span class="post-meta-item" title="所需閱讀時間">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>7 分鐘</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>原文連結：<span class="exturl" data-url="aHR0cHM6Ly9xaWl0YS5jb20vdGFkYXNoaXJvX25pbm9taXlhL2l0ZW1zLzE5Yzc3NDg5OGM2OGFkZDYxODVlP3V0bV9zb3VyY2U9UWlpdGElRTMlODMlOEIlRTMlODMlQTUlRTMlODMlQkMlRTMlODIlQjkmdXRtX2NhbXBhaWduPTUwN2YwOTU1NGMtUWlpdGFfbmV3c2xldHRlcl81ODNfMDlfMTMmdXRtX21lZGl1bT1lbWFpbCZ1dG1fdGVybT0wX2U0NGZlYWEwODEtNTA3ZjA5NTU0Yy02MjgyMDQ0OQ==">今さら聞けないログの基本と設計指針 - Qiita<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<p>在進行程式開發時，不論是前後端，應該都對 Log（日誌）再熟悉不過。尤其是在遇到非預期性的錯誤時，通常會需要立即調閱 Log，查看是否顯示錯誤訊息；或是在改良軟體時，需要透過 Log 來分析使用者行為等等。</p>
<p>接下來這篇文章，將會針對 Log（日誌）主題進行介紹，從 Log 相關的基礎知識、設計方法、操作時的注意事項，再到實際應用說明。 </p>
<span id="more"></span>

<p>文章架構如下：</p>
<ul>
<li>為什麼要輸出 Log？</li>
<li>為什麼要設計 Log？</li>
<li>有關 Log 的基礎知識<ul>
<li>Log 的級別與意義</li>
<li>Log 的輸出位置</li>
<li>Log 格式</li>
</ul>
</li>
<li>Log 的設計方法介紹<ul>
<li>設計 Log 時的確認事項與技巧</li>
<li>操作 Log 時的注意事項</li>
</ul>
</li>
<li>對實際的 Log 輸出進行說明<ul>
<li>基於 VM 的 Log 輸出</li>
<li>基於 Docker 的 Log 輸出</li>
<li>設計 Log 時不該做什麼</li>
</ul>
</li>
</ul>
<p>那麼，以下正文開始。</p>
<hr>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>各位對於 Log（日誌）的理解是什麼呢？可能有從機制到設計方法都完全理解的工程師，或者只是隨便用用的工程師存在。</p>
<p>Log 是系統中按照時間順序記錄，關於錯誤或故障發生、使用者操作或設定變更、與外部通信等內容。透過深入瞭解有關 Log 的知識，將能夠進行複雜的系統開發和運用。此外，如果使用 AWS、Azure、GCP 等雲端服務，不只能夠實現系統開發，還可能節省經費開支。</p>
<p>本文將介紹 Log 的基本設計方法。如果有任何疑問，請繼續閱讀下去。</p>
<h2 id="為什麼要輸出-Log？"><a href="#為什麼要輸出-Log？" class="headerlink" title="為什麼要輸出 Log？"></a>為什麼要輸出 Log？</h2><p>在討論 Log 的基本知識和 Log  的設計之前，首先必須瞭解為什麼需要輸出 Log。</p>
<p>主要考慮以下四個理由：</p>
<ul>
<li>在問題發生時進行調查</li>
<li>為了防止問題發生</li>
<li>通過資料分析來改良軟體</li>
<li>作為審計日誌使用</li>
</ul>
<p>通過輸出 Log，不只能夠調查和防止問題，還可以分析使用者的行為。或許目前還不太能感覺到輸出 Log 的必要性，但將來肯定會變得不可或缺。</p>
<h2 id="為什麼要設計-Log？"><a href="#為什麼要設計-Log？" class="headerlink" title="為什麼要設計 Log？"></a>為什麼要設計 Log？</h2><p>那麼，為什麼需要設計 Log 呢？</p>
<p>首先，Log 的設計將決定 Log 輸出的訊息和格式，基本方針是根據 Log 的使用目的來反推設計。</p>
<p>而設計 Log 的原因在於，將有助於選擇符合目的的 Log 並適當顯示。如上所述，Log 存在各種不同的類型，也因為如此，如何進行選擇和顯示其實相當複雜。</p>
<p>例如，以下將介紹使用 AWS 等雲端服務，進行系統開發的範例。雲端服務可以輕鬆實現橫向擴充和縮減，是非常方便的功能。</p>
<p>然而，容易擴展也意味著，可能存在大量不知道何時會出現或消失的伺服器。因此，在雲端系統中，各伺服器的 Log 會非同步寫入，即使將範圍縮小到毫秒單位，也很難找到特定的 Log。</p>
<p><img src="https://hackmd.io/_uploads/rJGyp9rZT.png"></p>
<p>因此，Log 的設計就變得非常重要。透過為特定事件的請求和回應，分配唯一可識別的 ID，即可藉此搜尋與目標事件相關的 Log。透過提前設計 Log，將有助於大幅減少 Log 搜尋時間。</p>
<p>以上只是一個範例，但建議在開發和操作複雜的系統時，務必進行 Log 設計。</p>
<h2 id="有關-Log-的基礎知識"><a href="#有關-Log-的基礎知識" class="headerlink" title="有關 Log 的基礎知識"></a>有關 Log 的基礎知識</h2><p>在介紹 Log 的設計之前，這裡先來瞭解有關 Log 的基礎知識！以下將簡單解釋相關內容，因此可以只挑選還不熟悉的部分閱讀。</p>
<ul>
<li>Log 的級別</li>
<li>Log 的輸出位置</li>
<li>Log 的格式</li>
</ul>
<h3 id="Log-的級別與意義"><a href="#Log-的級別與意義" class="headerlink" title="Log 的級別與意義"></a>Log 的級別與意義</h3><p>Log 具備權限分析、故障調查、安全性和稽核等多種用途。</p>
<p>下表整理出代表 Log 重要性的等級和類型，內容可能會依據所使用的開發語言、Log 管理系統和設計而有所變化，但基本如下所示：</p>
<table>
<thead>
<tr>
<th>種類</th>
<th>意思</th>
</tr>
</thead>
<tbody><tr>
<td>EMERG</td>
<td>系統不可利用</td>
</tr>
<tr>
<td>ALERT</td>
<td>必須立即採取行動</td>
</tr>
<tr>
<td>CRIT</td>
<td>嚴重缺失狀況</td>
</tr>
<tr>
<td>ERROR</td>
<td>發生錯誤的狀態</td>
</tr>
<tr>
<td>WARN</td>
<td>被警告的狀態</td>
</tr>
<tr>
<td>NOTICE</td>
<td>正常但重要的情況</td>
</tr>
<tr>
<td>INFO</td>
<td>資訊訊息</td>
</tr>
<tr>
<td>DEBUG</td>
<td>有關系統如何運作的訊息</td>
</tr>
</tbody></table>
<h3 id="Log-的輸出位置"><a href="#Log-的輸出位置" class="headerlink" title="Log 的輸出位置"></a>Log 的輸出位置</h3><p>原則上，Log 應該輸出到開發人員和維運人員容易找到的位置。如果想輸出到文件，建議創建一個 <code>log</code> 的目錄。基本上，預期會輸出以下四個位置：</p>
<ul>
<li><strong>輸出到文檔</strong><ul>
<li>這種方法適合在控制台以外啟動的應用程式。</li>
</ul>
</li>
<li><strong>標準輸出</strong><ul>
<li>這種方法適合用於從控制台啟動的應用程式，用於輸出中間過程等資訊。</li>
</ul>
</li>
<li><strong>輸出到外部日誌管理工具的文檔</strong><ul>
<li>如果可以使用外部日誌管理工具，建議將 Log 輸出到專用的記錄位置。</li>
</ul>
</li>
<li><strong>輸出到外部系統</strong><ul>
<li>為了方便開發者和運維人員的工作和溝通，有時會將 Log 輸出到如 Slack 等聊天工具中。但需注意維護適當的運行效率，避免輸出過多的 Log。</li>
</ul>
</li>
</ul>
<p>基本上，若使用外部日誌管理系統，或在雲端環境進行開發，這些專用工具通常會輸出到適當的位置。以雲端環境為例，如  Azure Application Insights 或  Amazon CloudWatch Logs 等工具。</p>
<p>此外，需要注意的是，不應該將 Log 輸出到未指定數量的使用者可以訪問的位置，或將系統內重要的資訊輸出到 Log，這通常被視為禁忌。</p>
<h3 id="Log-格式"><a href="#Log-格式" class="headerlink" title="Log 格式"></a>Log 格式</h3><p>Log 格式將決定 Log 輸出的內容。 例如輸出以下表格中的項目：</p>
<table>
<thead>
<tr>
<th>項目</th>
<th>内容</th>
<th>備註</th>
</tr>
</thead>
<tbody><tr>
<td>時間</td>
<td>記錄 Log 的時間</td>
<td>年月日時分秒毫秒。最少必須以毫秒為單位輸出</td>
</tr>
<tr>
<td>事件 ID</td>
<td>事件的 ID</td>
<td>追蹤事件序列時所需的</td>
</tr>
<tr>
<td>Log 級別</td>
<td>Log 的級別</td>
<td>INFO、ERROR 等</td>
</tr>
<tr>
<td>請求目標</td>
<td>對哪裡提出的請求</td>
<td>URL 等</td>
</tr>
<tr>
<td>使用者資訊</td>
<td>請求的使用者資訊</td>
<td>使用者 ID 和 IP 位置等</td>
</tr>
<tr>
<td>執行對象</td>
<td>對什麼進行處理</td>
<td>已執行的來源 ID 等</td>
</tr>
<tr>
<td>執行內容</td>
<td>執行什麼樣的處理</td>
<td>DELETE、PUT、GET 等</td>
</tr>
<tr>
<td>執行結果</td>
<td>執行結果是什麼</td>
<td>成功、失敗、執行件數等</td>
</tr>
<tr>
<td>訊息</td>
<td>其他要輸出的內容</td>
<td>Log 級別若大於 Error 時會希望顯示的訊息</td>
</tr>
</tbody></table>
<p>Log 輸出基本上以 5W1H 為基礎，並且輸出必要的資訊，不應過多或不足。</p>
<p>建議注意以下內容：</p>
<p>When → 何時執行該程序</p>
<p>Who → 是誰執行該程序</p>
<p>Where → 在哪執行該程序</p>
<p>What → 執行該程序做什麼</p>
<p>Why → 為什麼執行該程序</p>
<p>例如，以下就是一個理想格式的範例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>Log 級數<span class="token punctuation">)</span>　<span class="token punctuation">(</span>時間<span class="token punctuation">)</span>　<span class="token punctuation">(</span>IP 地址<span class="token punctuation">)</span>　<span class="token punctuation">(</span>執行對象<span class="token punctuation">)</span>　<span class="token punctuation">(</span>執行結果<span class="token punctuation">)</span>　<span class="token punctuation">(</span>訊息<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此格式的輸出 Log 如下所示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Error<span class="token punctuation">]</span> Feb <span class="token number">21</span> <span class="token number">12</span>:32:23, <span class="token number">193.121</span>.123, https-8080, Failed, client denied by server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>輸出的困難點在於，並非所有可輸出的訊息都要進行輸出，在進入 Log 設計之前，必須先釐清使用用途，這部分將在後半章節進行介紹。</p>
<p>以上資訊作為參考，接下來讓我們更深入理解 Log 設計吧！</p>
<h2 id="Log-的設計方法介紹"><a href="#Log-的設計方法介紹" class="headerlink" title="Log 的設計方法介紹"></a>Log 的設計方法介紹</h2><p>這裡開始，將會對 Log 的設計方法進行說明。</p>
<p>在設計 Log 時，比起建立具突破性的出色設計，更重要的是不犯錯誤。對此，接下來將對確認事項、技巧和需注意的部分進行說明。</p>
<p>首先是針對設計時的確認事項和技巧進行說明！</p>
<h3 id="設計-Log-時的確認事項與技巧"><a href="#設計-Log-時的確認事項與技巧" class="headerlink" title="設計 Log 時的確認事項與技巧"></a>設計 Log 時的確認事項與技巧</h3><p>接下來，將會說明設計 Log 時必須確認的要點，以及有關設計的技巧。透過牢記這些內容，將能夠有效進行 Log 分析。反之，如果忽略這些要點，Log 將變得毫無用處。</p>
<p>先是針對確認內容進行說明。</p>
<h4 id="・Log-的使用目的是什麼？"><a href="#・Log-的使用目的是什麼？" class="headerlink" title="・Log 的使用目的是什麼？"></a>・Log 的使用目的是什麼？</h4><p>Log 可使用於多種用途，如本文開頭附上的「Log 的類型與使用目的」表所介紹。正因為用途非常多樣，因此有必要確立使用目的。不只是開發人員，包括維運人員、企劃和法務部門等相關利益者的意見，都必須納入考量。</p>
<p>舉例來說，Log 的使用目的可能有以下三種：</p>
<ul>
<li>瞭解來自外部未經授權的訪問</li>
<li>防止資訊洩露等的內部控制</li>
<li>監控系統的使用狀態</li>
</ul>
<p>請確認適用於哪一個項目。</p>
<h4 id="・Log-的讀者是誰？"><a href="#・Log-的讀者是誰？" class="headerlink" title="・Log 的讀者是誰？"></a>・Log 的讀者是誰？</h4><p>確定使用目的後，應該考慮 Log 的讀者是誰。這些讀者可能包括開發人員、運維人員、客戶公司的員工等各種對象。根據不同的讀者，可能需要不同的輸出方式和輸出內容，因此，結合使用目的來考慮將會更理想。</p>
<p>例如，根據使用目的預期目標讀者，可以得出以下結果：</p>
<table>
<thead>
<tr>
<th>使用目的</th>
<th>讀者</th>
</tr>
</thead>
<tbody><tr>
<td>瞭解來自外部未經授權的訪問</td>
<td>運維人員、客戶公司的員工、法務人員、系統負責人等</td>
</tr>
<tr>
<td>防止資訊洩露等的內部控制</td>
<td>開發人員、運維人員、客戶公司的員工、法務人員等</td>
</tr>
<tr>
<td>監控系統的使用狀態</td>
<td>開發人員、運維人員等</td>
</tr>
</tbody></table>
<p>掌握這些確認事項後，設計 Log 的準備工作也差不多完成。</p>
<p>接下來，將介紹設計 Log 時需考慮的要點。</p>
<h4 id="・考慮使用哪種格式"><a href="#・考慮使用哪種格式" class="headerlink" title="・考慮使用哪種格式"></a>・考慮使用哪種格式</h4><p>在實際設計 Log 時，需要確定 Log 的格式。Log 的格式代表 Log 中包含哪些資訊，這部分必須和 Log 的目標讀者討論並確定格式。</p>
<p>可參考以下格式：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>Log 級數<span class="token punctuation">)</span>　<span class="token punctuation">(</span>時間<span class="token punctuation">)</span>　<span class="token punctuation">(</span>IP 地址<span class="token punctuation">)</span>　<span class="token punctuation">(</span>執行對象<span class="token punctuation">)</span>　<span class="token punctuation">(</span>執行結果<span class="token punctuation">)</span>　<span class="token punctuation">(</span>訊息<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用這種格式輸出的 Log，將如下所示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Error<span class="token punctuation">]</span> Feb <span class="token number">21</span> <span class="token number">12</span>:32:23, <span class="token number">193.121</span>.123, https-8080, Failed, client denied by server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在這裡，可以考慮添加 Log 讀者的需求。例如，如果目標對象是法務人員，那麼列出 IP 地址和執行對象資訊，可能不會有太大意義。</p>
<p>因此，將訊息部分移至 Log 的前半部等其他改進，或許會更有幫助。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>Log 級數<span class="token punctuation">)</span>　<span class="token punctuation">(</span>時間<span class="token punctuation">)</span>　<span class="token punctuation">(</span>訊息<span class="token punctuation">)</span>　<span class="token punctuation">(</span>IP 地址<span class="token punctuation">)</span>　<span class="token punctuation">(</span>執行對象<span class="token punctuation">)</span>　<span class="token punctuation">(</span>執行結果<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Error<span class="token punctuation">]</span> Feb <span class="token number">21</span> <span class="token number">12</span>:32:23, client denied by server, <span class="token number">193.121</span>.123, https-8080, Failed<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="・思考包括什麼樣的訊息"><a href="#・思考包括什麼樣的訊息" class="headerlink" title="・思考包括什麼樣的訊息"></a>・思考包括什麼樣的訊息</h4><p>Log 格式中，包括一個名為訊息的項目。Log 扮演的角色，是以易於理解的方式傳達系統狀態。透過充分利用這些訊息，將能發揮其效用至最大限度。如果是在輸出錯誤 Log 的情況，則務必描述預期錯誤的原因。</p>
<p>此外，也必須考慮設計符合潛在讀者 IT 素養的訊息。假設使用目的是「瞭解來自外部未經授權的訪問」，那麼非技術人員可能也會閱讀這些訊息，因此應該以簡單的語言解釋問題和錯誤發生原因，即使沒有專業知識背景，也能夠理解內容。</p>
<h4 id="・斟酌選擇-Log-級別"><a href="#・斟酌選擇-Log-級別" class="headerlink" title="・斟酌選擇 Log 級別"></a>・斟酌選擇 Log 級別</h4><p>正如本文前半部分提供的「Log 級別和含義」表中所示，Log 具有級別的概念。透過定義級別，能夠在達到一定程度以上級別的訊息時通知負責人，同時避免收到不必要的通知造成干擾。</p>
<p>具體來說，除了「監控系統的使用狀態」以外的目的，並不需要使用到 DEBUG 級別的 Log。如果使用目的為「防止資訊洩漏等內部控制」，即使出現無法使用系統的 EMERG 的 Log，也無法有任何作為，因此沒有這麼必要。</p>
<p>請參考這些內容來設計 Log。</p>
<h3 id="操作-Log-時的注意事項"><a href="#操作-Log-時的注意事項" class="headerlink" title="操作 Log 時的注意事項"></a>操作 Log 時的注意事項</h3><p>接下來，將會介紹操作 Log 時的注意事項，主要是避免在搜索目標 Log 時出現問題。</p>
<h4 id="將-Log-檔案分割處理"><a href="#將-Log-檔案分割處理" class="headerlink" title="將 Log 檔案分割處理"></a>將 Log 檔案分割處理</h4><p>在調查 Log 時，可以透過減少目標 Log的數量來縮短調查時間。 為此，建議將 Log 檔進行分割處理，例如：按時間或網站為單位來分割 Log 檔，藉此提升工作效率。</p>
<p>如果使用的是 <span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLXR3LyVFNiU5NyVBNSVFNSVCRiU5NyVFOCVCRCVBRSVFNiU5QiVCRg==">logrotate<i class="fa fa-external-link-alt"></i></span>，並希望分割 Log 檔案時，則應修改位於 <code>etc/logrotate.d</code> 的日誌輪替（Log Rotation）設定檔。</p>
<p>舉例來說，<code>sample-service</code> 使用的 Log 設定檔位於 <code>etc/logrotate.d/sample-service</code> ，內容如下所示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/var/log/sample-service/sample.log <span class="token punctuation">&#123;</span> <span class="token comment"># 目標 Log 檔案</span>
    ifempty            <span class="token comment"># 即使 Log 檔案為空也進行輪替</span>
    missingok          <span class="token comment"># 即使沒有 Log 檔案也不會發出錯誤</span>
    compress           <span class="token comment"># 進行壓縮</span>
    daily              <span class="token comment"># 毎日輪替</span>
    rotate <span class="token number">10</span>          <span class="token comment"># 保留最近 10 個分割後的 Log 檔案</span>
    create             <span class="token comment"># 更新後建立一個新的 Log 檔案</span>
    endscript
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>create</code> 這個指令，可用於分割 Log 檔案，因此請確認檔案中是否有此指令。</p>
<p>此外，如果希望新建立的 Log 檔能包含更新日期，請執行以下操作：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/var/log/sample-service/sample.log <span class="token punctuation">&#123;</span> <span class="token comment"># 目標 Log 檔案</span>
    ifempty            <span class="token comment"># 即使 Log 檔案為空也進行輪替</span>
    missingok          <span class="token comment"># 即使沒有 Log 檔案也不會發出錯誤</span>
    compress           <span class="token comment"># 進行壓縮</span>
    daily              <span class="token comment"># 毎日輪替</span>
    rotate <span class="token number">10</span>          <span class="token comment"># 保留最近 10 個分割後的 Log 檔案</span>
    dateext            <span class="token comment"># 建立一個包含更新日期的檔案</span>
    endscript
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>透過添加 <code>dateext</code> 這個指令，檔名將會更改為 <code>原檔案名稱 + -YYYYMMDD</code></p>
<h4 id="採用結構化日誌記錄"><a href="#採用結構化日誌記錄" class="headerlink" title="採用結構化日誌記錄"></a>採用結構化日誌記錄</h4><p>如果情況允許，請務必採用結構化日誌記錄（Structured Logging）。 結構化日誌記錄是透過標準化 Log 輸出格式，並作為結構化資料合集而非單文本處理，常見格式為 Json。 結構化日誌記錄不只易於和其他工具連結，還具備高性能搜索等優點。</p>
<p>請參考以下範例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Error<span class="token punctuation">]</span> Feb <span class="token number">21</span> <span class="token number">12</span>:32:23, <span class="token number">193.121</span>.123, https-8080, Failed, client denied by server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>以上顯示的 Log 會是：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jsonPayload: <span class="token punctuation">&#123;</span>
    <span class="token string">"level"</span><span class="token builtin class-name">:</span> <span class="token string">"[Error]"</span>,
    <span class="token string">"timestamp"</span><span class="token builtin class-name">:</span> <span class="token string">"Feb 21 12:32:23"</span>,
    <span class="token string">"host"</span><span class="token builtin class-name">:</span> <span class="token string">"193.121.123"</span>,
    <span class="token string">"port-number"</span><span class="token builtin class-name">:</span> <span class="token string">"https-8080"</span>,
    <span class="token string">"result"</span><span class="token builtin class-name">:</span> <span class="token string">"Failed"</span>,
    <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"client denied by server"</span>,
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以像這樣進行結構化。</p>
<p>對人類來說可能有點難以閱讀，但從機器的角度來看，結構化日誌將更容易閱讀，因此建議導入使用。</p>
<h4 id="時間同步和時區設定"><a href="#時間同步和時區設定" class="headerlink" title="時間同步和時區設定"></a>時間同步和時區設定</h4><p>在調查 Log 時，可能想知道該 Log 的輸出時間。如果未完成伺服器和本地時間同步，或沒有設定相同時區，將無法好好處理時間。此外，若是更改設定，則需重新啟動伺服器以使其生效！</p>
<p>若要更改本地時間 <code>/etc/localtime</code> ，請在終端機輸入以下指令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// 東京時區
<span class="token function">cp</span> /usr/share/zoneinfo/Asia/Tokyo /etc/localtime

// 台北時區
<span class="token function">cp</span> /usr/share/zoneinfo/Asia/Taipei /etc/localtime<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接著輸入 <code>date</code> 指令，確認是否顯示以下內容（是否為 JST）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Wed Dec  <span class="token number">12</span> <span class="token number">13</span>:15:11 JST <span class="token number">2015</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此外，可透過 <code>/etc/timezone</code> 檢查時區。 輸入 <code>$ cat /etc/timezone</code> 指令後，檢查輸出是否類似以下內容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Asia/Tokyo

Asia/Taipei<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果輸出結果不同，請試著重寫內容。</p>
<h4 id="確認日誌輪替的基本設定"><a href="#確認日誌輪替的基本設定" class="headerlink" title="確認日誌輪替的基本設定"></a>確認日誌輪替的基本設定</h4><p>日誌輪替（Log rotation）是種按照一定容量或時間間隔，刪除較舊的 Log 或拆分檔案，以防止 Log 無限增長的功能。在執行日誌輪替時，應確認使用指令的預設配置。輪替不一定是在 0 點進行，有時可能也無法按日期拆分檔案。</p>
<p>如果要更改日誌輪替的時間，請按照以下步驟進行（以使用 logrotate 為例）。</p>
<p>首先，從正在運行 logrotate 的 <code>etc/cron.daily</code> 中，刪除 anacron 設定，請註解或刪除以下行列：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>hour<span class="token punctuation">]</span>     <span class="token punctuation">[</span>minutes<span class="token punctuation">]</span>     cron.daily     <span class="token function">nice</span> run-parts /etc/cron.daily<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>接下來，在 crontab 中註冊 <code>/etc/cron.daily</code> 寫上希望運行的時間。 具體來說，就是開啟 <code>etc/crontab</code> 檔案，並添加以下行列：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">23</span>     <span class="token number">59</span>     cron.daily     root run-parts /etc/cron.daily<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如此一來，日誌輪換將會在 23:59 進行。</p>
<h4 id="使用-Dokcer-時需注意"><a href="#使用-Dokcer-時需注意" class="headerlink" title="使用 Dokcer 時需注意"></a>使用 <span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLXR3L0RvY2tlcg==">Dokcer<i class="fa fa-external-link-alt"></i></span> 時需注意</h4><p>如果使用 Docker 的情況，可能會在 Docker 內部容器中的檔案輸出 Log。在這種情況下，若是重新建立 Docker 容器，將導致 Log 輸出檔案也一併被刪除，因此請務必更改輸出位置。</p>
<p>想要更改輸出位置，請在啟動 Docker 時執行以下指令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run --log-driver<span class="token operator">=</span><span class="token operator">&lt;</span>Driver Name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>本文的後半部分，將會詳細介紹有關 Docker 的 Log 輸出。如果對 Driver（驅動程式）部分感到疑惑，也請繼續往下閱讀。</p>
<h4 id="使用-CDN-或反向代理時需注意"><a href="#使用-CDN-或反向代理時需注意" class="headerlink" title="使用 CDN 或反向代理時需注意"></a>使用 CDN 或反向代理時需注意</h4><p>如果使用 CDN 或反向代理，需注意其 IP 地址可能會被輸出為 Log。但由於 Client 端的 IP 地址已經正確記錄在別處的標頭欄位中，因此需要更改設定以記錄相關內容。</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvTmdpbng=">Nginx<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLXR3L1Zhcm5pc2hfY2FjaGU=">Varnish<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvVHJhZmZpY19TZXJ2ZXI=">Apache Traffic Server<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLXR3L0hBUHJveHk=">HAProxy<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>更改設定的方法，將根據反向代理而有所差異。 以上列舉幾項反向代理，建議根據自己使用的工具，查詢更改設定的相關方法。</p>
<p>但我希望您能找到如何使用您正在使用的內容更改設置。</p>
<h2 id="對實際的-Log-輸出進行說明"><a href="#對實際的-Log-輸出進行說明" class="headerlink" title="對實際的 Log 輸出進行說明"></a>對實際的 Log 輸出進行說明</h2><p>到目前為止，已介紹通用的 Log 設計相關基礎知識。在最後部分中，將藉由一系列的情境來說明 Log 輸出的不同階段。</p>
<p>在實際輸出 Log 時，總共有三個階段：</p>
<ul>
<li><strong>日誌輸出 Log Output</strong><ul>
<li>是以什麼格式，在何時輸出</li>
</ul>
</li>
<li><strong>日誌輪換 Log Rotation</strong><ul>
<li>如何處理不斷增長的日誌數量</li>
</ul>
</li>
<li><strong>日誌聚合 Log Aggregation</strong><ul>
<li>如何長時間保存日誌</li>
</ul>
</li>
</ul>
<p>在每個階段中，都需要注意不同事項。以下是針對各種情境的注意事項進行說明。</p>
<h3 id="基於-VM-的-Log-輸出"><a href="#基於-VM-的-Log-輸出" class="headerlink" title="基於 VM 的 Log 輸出"></a>基於 VM 的 Log 輸出</h3><p>首先，將對基於 VM（虛擬機器）的 Log 輸出流程進行說明。舉例來說，對於在 AWS 的 EC2 上運行的應用程式，在上述三個階段（誌輸出、日誌輪替、日誌集約）當中，應特別注意「日誌輸出」。</p>
<h4 id="日誌輸出"><a href="#日誌輸出" class="headerlink" title="日誌輸出"></a>日誌輸出</h4><p>通常最初想到的輸出方法，是由應用程式直接輸出到 Log 檔案的模式，這是許多框架的預設配置。</p>
<p>另一方面，被稱為應用程式開發的最佳實踐 <span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVHdlbHZlLUZhY3Rvcl9BcHBfbWV0aG9kb2xvZ3k=">The Twelve-factor App（12 要素應用程式）<i class="fa fa-external-link-alt"></i></span>，則表示應用程式生成的 Log 不應該直接由 Log 檔案進行管理。<br>而作為替代方案，建議採取以下方法：</p>
<ul>
<li>以標準輸出的方式輸出日誌，並使用日誌管理系統將其輸出到檔案中</li>
</ul>
<p>透過這種方式，在測試或部署環境中，將無法透過應用程式查看或設定 Log，只能由執行環境進行全面管理。</p>
<h3 id="基於-Docker-的-Log-輸出"><a href="#基於-Docker-的-Log-輸出" class="headerlink" title="基於 Docker 的 Log 輸出"></a>基於 Docker 的 Log 輸出</h3><p>如「操作 Log 時的注意事項」段落所述，在 Docker 容器中，刪除容器時會將連同所有寫入的資料一起被棄用。換句話說，基於 Docker 的 Log 輸出之所以困難，在於日誌聚合。為了正確執行日誌聚合，可參考以下兩種方法：</p>
<ul>
<li>指定 volume 目標並永久保存</li>
<li>使用 log driver 傳輸</li>
</ul>
<p>以下將會逐一進行介紹。</p>
<h4 id="指定-volume-目標並永久保存"><a href="#指定-volume-目標並永久保存" class="headerlink" title="指定 volume 目標並永久保存"></a>指定 volume 目標並永久保存</h4><p>透過使用 volume，將能夠永久保存主機的資料。為了避免中斷引用，請使用 <code>--volumes-from &lt;container_name&gt;</code> 或 <code>--v &lt;host_path&gt;:&lt;container_path&gt;</code> 將其保存在資料容器中。</p>
<p>然而另一方面，若是因為<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLXR3LyVFNSVCQyVCOSVFNiU4MCVBNyVFNCVCQyVCOCVFNyVCQyVBOQ==">自動規模化<i class="fa fa-external-link-alt"></i></span>等功能，導致實例本身也被頻繁刪除的情況，則必須將 Log 轉移到其他位置保存。在這種情況下，則必須準備一個類似於 <span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmx1ZW50ZA==">fluentd<i class="fa fa-external-link-alt"></i></span> 容器，透過能夠將收集的資料暫存到緩衝區的機制，將 volume 掛載（mount）以進行傳送等處理。</p>
<h4 id="使用-Logging-Driver-傳輸"><a href="#使用-Logging-Driver-傳輸" class="headerlink" title="使用 Logging Driver 傳輸"></a>使用 Logging Driver 傳輸</h4><p>透過 Docker 提供的日誌記錄驅動機制（Logging Driver），能夠將 Log 傳輸到外部日誌記錄軟體，即使是在結構複雜的容器，也能夠實現日誌聚合。</p>
<p>在 Logging Driver 中，可以在容器啟動時指定輸出目標，將 Log 輸出到指定的日誌管理系統。通常使用「json-file」Driver，但從 Docker 1.12 版本開始，還提供以下幾種類型的 Driver 使用：</p>
<table>
<thead>
<tr>
<th>Driver</th>
<th>輸出目標</th>
</tr>
</thead>
<tbody><tr>
<td>json-file</td>
<td>以 Json 格式儲存在檔案</td>
</tr>
<tr>
<td>（Docker Default）</td>
<td></td>
</tr>
<tr>
<td>none</td>
<td>不記錄 Log</td>
</tr>
<tr>
<td>syslog</td>
<td>syslog</td>
</tr>
<tr>
<td>journald</td>
<td>journald</td>
</tr>
<tr>
<td>gelf</td>
<td>支援 gelf 的 Log 管理系統</td>
</tr>
<tr>
<td>fluentd</td>
<td>Log 管理工具「fluentd」</td>
</tr>
<tr>
<td>awslogs</td>
<td>AWS 提供的 Log 管理系統「Amazon CloudWatch Logs」</td>
</tr>
<tr>
<td>splunk</td>
<td>Log 管理系統「Splunk」</td>
</tr>
<tr>
<td>etwlogs</td>
<td>Windows 的 Event Tracing for Windows</td>
</tr>
<tr>
<td>gcplogs</td>
<td>GCP 提供的 Log 管理系統「Google Cloud Logging」</td>
</tr>
</tbody></table>
<p>若要實際指定 Driver，可在容器啟動時輸入 <code>docker run --log-driver=&lt;driver name&gt;</code>。如果只輸入 <code>docker run</code>，則會使用預設的「json-file」Driver。</p>
<h3 id="設計-Log-時不該做什麼"><a href="#設計-Log-時不該做什麼" class="headerlink" title="設計 Log 時不該做什麼"></a>設計 Log 時不該做什麼</h3><p>最後要介紹的，是設計 Log 時不應該執行的兩件事。</p>
<h4 id="不輸出機密資訊"><a href="#不輸出機密資訊" class="headerlink" title="不輸出機密資訊"></a>不輸出機密資訊</h4><p>導致資訊洩露的原因之一，就是 Log 輸出機密資訊。 對於應該只有開發人員和負責人才能知道 Log，是否就此感到安心了？ 事實上，透過未經授權的訪問，將有可能查看 Log。 因此為了以防萬一，請再三確保重要的機密資訊不會作為 Log 輸出。</p>
<p>請注意並確保重要的機密資訊不會作為日誌輸出，</p>
<p>如下所示：</p>
<ul>
<li>姓名</li>
<li>地址</li>
<li>電話號碼</li>
<li>電子郵件地址</li>
<li>密碼</li>
<li>Access Token</li>
<li>信用卡號碼</li>
</ul>
<p>等機密資訊。</p>
<h4 id="不輸出不必要的資訊"><a href="#不輸出不必要的資訊" class="headerlink" title="不輸出不必要的資訊"></a>不輸出不必要的資訊</h4><p>不輸出不必要的資訊，原因有以下三種：</p>
<ul>
<li>若增加 Log 的大小，將會增加服務使用費。</li>
<li>進行調查時可能造成妨礙</li>
<li>將導致系統性能下降</li>
</ul>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>在本文中，介紹了如何設計 Log！ 如果正在進行開發，一定會使用到這些 Log，希望從明天開始就能夠實際應用開發中！</p>
<p>敝公司 Nuco 目前正在招募中，詳細可<span class="exturl" data-url="aHR0cHM6Ly93d3cucmVjcnVpdC5udWNvLmNvLmpwLz9xaWl0YV9pdGVtX2lkPTE5Yzc3NDg5OGM2OGFkZDYxODVl">參考這裡<i class="fa fa-external-link-alt"></i></span>。</p>
<blockquote>
<p>15th鐵人賽目錄傳送門：<span class="exturl" data-url="aHR0cHM6Ly9pdGhlbHAuaXRob21lLmNvbS50dy91c2Vycy8yMDEzNTU1OC9pcm9ubWFuLzYyOTA=">https://ithelp.ithome.com.tw/users/20135558/ironman/6290<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Back-End/" rel="tag"># Back-End</a>
              <a href="/tags/ironman2023/" rel="tag"># ironman2023</a>
              <a href="/tags/Qiita/" rel="tag"># Qiita</a>
              <a href="/tags/Log/" rel="tag"># Log</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/ironman-2023-day-27/" rel="prev" title="[2023 15th鐵人賽] Day27 - [常有的事] 克服「遇到問題卡住時，請立刻提問」的方法">
      <i class="fa fa-chevron-left"></i> [2023 15th鐵人賽] Day27 - [常有的事] 克服「遇到問題卡住時，請立刻提問」的方法
    </a></div>
      <div class="post-nav-item">
    <a href="/ironman-2023-day-29/" rel="next" title="[2023 15th鐵人賽] Day29 - AWS Engineer Roadmap 2023">
      [2023 15th鐵人賽] Day29 - AWS Engineer Roadmap 2023 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
          <div style="">
            
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

          </div>
        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E8%BC%B8%E5%87%BA-Log%EF%BC%9F"><span class="nav-number">2.</span> <span class="nav-text">為什麼要輸出 Log？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E8%A8%AD%E8%A8%88-Log%EF%BC%9F"><span class="nav-number">3.</span> <span class="nav-text">為什麼要設計 Log？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%89%E9%97%9C-Log-%E7%9A%84%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98"><span class="nav-number">4.</span> <span class="nav-text">有關 Log 的基礎知識</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Log-%E7%9A%84%E7%B4%9A%E5%88%A5%E8%88%87%E6%84%8F%E7%BE%A9"><span class="nav-number">4.1.</span> <span class="nav-text">Log 的級別與意義</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Log-%E7%9A%84%E8%BC%B8%E5%87%BA%E4%BD%8D%E7%BD%AE"><span class="nav-number">4.2.</span> <span class="nav-text">Log 的輸出位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Log-%E6%A0%BC%E5%BC%8F"><span class="nav-number">4.3.</span> <span class="nav-text">Log 格式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Log-%E7%9A%84%E8%A8%AD%E8%A8%88%E6%96%B9%E6%B3%95%E4%BB%8B%E7%B4%B9"><span class="nav-number">5.</span> <span class="nav-text">Log 的設計方法介紹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A8%AD%E8%A8%88-Log-%E6%99%82%E7%9A%84%E7%A2%BA%E8%AA%8D%E4%BA%8B%E9%A0%85%E8%88%87%E6%8A%80%E5%B7%A7"><span class="nav-number">5.1.</span> <span class="nav-text">設計 Log 時的確認事項與技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E3%83%BBLog-%E7%9A%84%E4%BD%BF%E7%94%A8%E7%9B%AE%E7%9A%84%E6%98%AF%E4%BB%80%E9%BA%BC%EF%BC%9F"><span class="nav-number">5.1.1.</span> <span class="nav-text">・Log 的使用目的是什麼？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E3%83%BBLog-%E7%9A%84%E8%AE%80%E8%80%85%E6%98%AF%E8%AA%B0%EF%BC%9F"><span class="nav-number">5.1.2.</span> <span class="nav-text">・Log 的讀者是誰？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E3%83%BB%E8%80%83%E6%85%AE%E4%BD%BF%E7%94%A8%E5%93%AA%E7%A8%AE%E6%A0%BC%E5%BC%8F"><span class="nav-number">5.1.3.</span> <span class="nav-text">・考慮使用哪種格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E3%83%BB%E6%80%9D%E8%80%83%E5%8C%85%E6%8B%AC%E4%BB%80%E9%BA%BC%E6%A8%A3%E7%9A%84%E8%A8%8A%E6%81%AF"><span class="nav-number">5.1.4.</span> <span class="nav-text">・思考包括什麼樣的訊息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E3%83%BB%E6%96%9F%E9%85%8C%E9%81%B8%E6%93%87-Log-%E7%B4%9A%E5%88%A5"><span class="nav-number">5.1.5.</span> <span class="nav-text">・斟酌選擇 Log 級別</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C-Log-%E6%99%82%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><span class="nav-number">5.2.</span> <span class="nav-text">操作 Log 時的注意事項</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%87-Log-%E6%AA%94%E6%A1%88%E5%88%86%E5%89%B2%E8%99%95%E7%90%86"><span class="nav-number">5.2.1.</span> <span class="nav-text">將 Log 檔案分割處理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A1%E7%94%A8%E7%B5%90%E6%A7%8B%E5%8C%96%E6%97%A5%E8%AA%8C%E8%A8%98%E9%8C%84"><span class="nav-number">5.2.2.</span> <span class="nav-text">採用結構化日誌記錄</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%99%82%E9%96%93%E5%90%8C%E6%AD%A5%E5%92%8C%E6%99%82%E5%8D%80%E8%A8%AD%E5%AE%9A"><span class="nav-number">5.2.3.</span> <span class="nav-text">時間同步和時區設定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A2%BA%E8%AA%8D%E6%97%A5%E8%AA%8C%E8%BC%AA%E6%9B%BF%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A8%AD%E5%AE%9A"><span class="nav-number">5.2.4.</span> <span class="nav-text">確認日誌輪替的基本設定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Dokcer-%E6%99%82%E9%9C%80%E6%B3%A8%E6%84%8F"><span class="nav-number">5.2.5.</span> <span class="nav-text">使用 Dokcer 時需注意</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-CDN-%E6%88%96%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E6%99%82%E9%9C%80%E6%B3%A8%E6%84%8F"><span class="nav-number">5.2.6.</span> <span class="nav-text">使用 CDN 或反向代理時需注意</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8D%E5%AF%A6%E9%9A%9B%E7%9A%84-Log-%E8%BC%B8%E5%87%BA%E9%80%B2%E8%A1%8C%E8%AA%AA%E6%98%8E"><span class="nav-number">6.</span> <span class="nav-text">對實際的 Log 輸出進行說明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%96%BC-VM-%E7%9A%84-Log-%E8%BC%B8%E5%87%BA"><span class="nav-number">6.1.</span> <span class="nav-text">基於 VM 的 Log 輸出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E8%AA%8C%E8%BC%B8%E5%87%BA"><span class="nav-number">6.1.1.</span> <span class="nav-text">日誌輸出</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%96%BC-Docker-%E7%9A%84-Log-%E8%BC%B8%E5%87%BA"><span class="nav-number">6.2.</span> <span class="nav-text">基於 Docker 的 Log 輸出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-volume-%E7%9B%AE%E6%A8%99%E4%B8%A6%E6%B0%B8%E4%B9%85%E4%BF%9D%E5%AD%98"><span class="nav-number">6.2.1.</span> <span class="nav-text">指定 volume 目標並永久保存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Logging-Driver-%E5%82%B3%E8%BC%B8"><span class="nav-number">6.2.2.</span> <span class="nav-text">使用 Logging Driver 傳輸</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A8%AD%E8%A8%88-Log-%E6%99%82%E4%B8%8D%E8%A9%B2%E5%81%9A%E4%BB%80%E9%BA%BC"><span class="nav-number">6.3.</span> <span class="nav-text">設計 Log 時不該做什麼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E8%BC%B8%E5%87%BA%E6%A9%9F%E5%AF%86%E8%B3%87%E8%A8%8A"><span class="nav-number">6.3.1.</span> <span class="nav-text">不輸出機密資訊</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E8%BC%B8%E5%87%BA%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E8%B3%87%E8%A8%8A"><span class="nav-number">6.3.2.</span> <span class="nav-text">不輸出不必要的資訊</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B8%BD%E7%B5%90"><span class="nav-number">7.</span> <span class="nav-text">總結</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Heidi Liu"
      src="https://avatars3.githubusercontent.com/u/65410665?s=460&u=887bd602944dcf78b90f3a880b03aec4e086728a&v=4">
  <p class="site-author-name" itemprop="name">Heidi Liu</p>
  <div class="site-description" itemprop="description">海底修羅場｜日々進化中</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">120</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hlaWRpbGl1MjAyMA==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;heidiliu2020"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9oZWlkaS1jb2RpbmcubWVkaXVtLmNvbS8=" title="Medium → https:&#x2F;&#x2F;heidi-coding.medium.com&#x2F;"><i class="fab fa-medium fa-fw"></i>Medium</span>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Heidi Liu</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Gemini</span> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='220,220,220' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

<script>
  var disqus_config = function() {
    this.page.url = "https://heidiliu2020.github.io/ironman-2023-day-28/";
    this.page.identifier = "ironman-2023-day-28/";
    this.page.title = "[2023 15th鐵人賽] Day28 - 事到如今問不出口的 Log 基礎和設計指南";
    this.language = "zh_TW"; 
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://heidiblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

    </div>
</body>
</html>
