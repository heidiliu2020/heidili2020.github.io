<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"heidiliu2020.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":true,"sidebar":{"position":"right","Pisces | Gemini":200,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本篇為 [BE201] 後端中階：Express 與 Sequelize 這門課程的學習筆記。如有錯誤歡迎指正！  1234學習目標： P1 學習如何使用 Express 及其相關套件 P1 我理解為什麼會需要框架">
<meta property="og:type" content="article">
<meta property="og:title" content="[week 17] 後端中階 - 使用 Node.js + Express 框架建立一個靜態網頁">
<meta property="og:url" content="https://heidiliu2020.github.io/express/index.html">
<meta property="og:site_name" content="前端新米">
<meta property="og:description" content="本篇為 [BE201] 後端中階：Express 與 Sequelize 這門課程的學習筆記。如有錯誤歡迎指正！  1234學習目標： P1 學習如何使用 Express 及其相關套件 P1 我理解為什麼會需要框架">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/2Bv9WKj.png">
<meta property="og:image" content="https://i.imgur.com/ZY79LWh.png">
<meta property="og:image" content="https://i.imgur.com/LbCRc8S.png">
<meta property="og:image" content="https://i.imgur.com/t5Gx1JF.png">
<meta property="og:image" content="https://i.imgur.com/Ya0XugX.png">
<meta property="og:image" content="https://i.imgur.com/qOagjRg.png">
<meta property="og:image" content="https://i.imgur.com/VG4okLU.png">
<meta property="og:image" content="https://i.imgur.com/NYQmfRF.png">
<meta property="og:image" content="https://i.imgur.com/6T6umyx.png">
<meta property="og:image" content="https://i.imgur.com/EYfvLe0.png">
<meta property="og:image" content="https://i.imgur.com/zXWH67g.png">
<meta property="og:image" content="https://i.imgur.com/aYBYHlx.png">
<meta property="og:image" content="https://i.imgur.com/DixdfOM.png">
<meta property="og:image" content="https://i.imgur.com/PVJjWAG.png">
<meta property="og:image" content="https://i.imgur.com/G32u0NI.png">
<meta property="og:image" content="https://i.imgur.com/dKhAwTu.png">
<meta property="og:image" content="https://i.imgur.com/zGLAWIT.png">
<meta property="og:image" content="https://i.imgur.com/crYUBSj.png">
<meta property="og:image" content="https://i.imgur.com/tR8kezb.png">
<meta property="og:image" content="https://i.imgur.com/kCpCApB.png">
<meta property="og:image" content="https://i.imgur.com/Flh0kkx.png">
<meta property="og:image" content="https://i.imgur.com/Bd9TEJB.png">
<meta property="og:image" content="https://i.imgur.com/UKf0NJ7.png">
<meta property="og:image" content="https://i.imgur.com/M9sO5ZS.png">
<meta property="og:image" content="https://i.imgur.com/KGhvnqv.png">
<meta property="og:image" content="https://i.imgur.com/aSpv3e4.png">
<meta property="og:image" content="https://i.imgur.com/WMopGth.png">
<meta property="og:image" content="https://i.imgur.com/02Wnbnb.png">
<meta property="og:image" content="https://i.imgur.com/NZ0Hzj3.png">
<meta property="article:published_time" content="2020-10-25T16:36:00.000Z">
<meta property="article:modified_time" content="2020-12-29T15:02:18.359Z">
<meta property="article:author" content="Heidi Liu">
<meta property="article:tag" content="Back-End">
<meta property="article:tag" content="Express">
<meta property="article:tag" content="Node.js">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/2Bv9WKj.png">

<link rel="canonical" href="https://heidiliu2020.github.io/express/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>[week 17] 後端中階 - 使用 Node.js + Express 框架建立一個靜態網頁 | 前端新米</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SK3E4H2TXJ"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-SK3E4H2TXJ');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">前端新米</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Heidi's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-首頁">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-文章列表">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章列表</a>

  </li>
        <li class="menu-item menu-item-關於我">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>關於我</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://heidiliu2020.github.io/express/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/65410665?s=460&u=887bd602944dcf78b90f3a880b03aec4e086728a&v=4">
      <meta itemprop="name" content="Heidi Liu">
      <meta itemprop="description" content="海底修羅場｜日々進化中">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端新米">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [week 17] 後端中階 - 使用 Node.js + Express 框架建立一個靜態網頁
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2020-10-26 00:36:00" itemprop="dateCreated datePublished" datetime="2020-10-26T00:36:00+08:00">2020-10-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2020-12-29 23:02:18" itemprop="dateModified" datetime="2020-12-29T23:02:18+08:00">2020-12-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Back-End/" itemprop="url" rel="index"><span itemprop="name">Back-End</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>本篇為 <span class="exturl" data-url="aHR0cHM6Ly9saWRlbXkuY29tL3AvYmUyMDEtZXhwcmVzcy1zZXF1ZWxpemU=">[BE201] 後端中階：Express 與 Sequelize<i class="fa fa-external-link-alt"></i></span> 這門課程的學習筆記。如有錯誤歡迎指正！</p>
</blockquote>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs armasm">學習目標：<br><br> <span class="hljs-built_in">P1</span> 學習如何使用 Express 及其相關套件<br> <span class="hljs-built_in">P1</span> 我理解為什麼會需要框架<br></code></pre></td></tr></table></figure>
<a id="more"></a>
<hr>
<h2 id="要學框架，先從不用框架開始"><a href="#要學框架，先從不用框架開始" class="headerlink" title="要學框架，先從不用框架開始"></a>要學框架，先從不用框架開始</h2><p>在講解什麼是 Express 框架以前，先來談談什麼是 Server，其實 Server 也是一種程式，而 <span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3JnL2VuLw==">Node.js<i class="fa fa-external-link-alt"></i></span> 本身就有提供內建 Library，讓我們能透過引入 modeule 來使用 Server 的功能。 </p>
<h3 id="範例：以-Node-js-實作一個-Server"><a href="#範例：以-Node-js-實作一個-Server" class="headerlink" title="範例：以 Node.js 實作一個 Server"></a>範例：以 Node.js 實作一個 Server</h3><p>建立一個 js 檔，並引入 Node.js 內建 http 相關 module，再以 createServer() 建立 server：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// node.js 內建 http 相關 module</span><br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>)<br><span class="hljs-comment">// createServer() 要傳入的參數是 function</span><br><span class="hljs-keyword">const</span> server = http.createServer(handler)<br><br><span class="hljs-comment">// 兩個參數分別是 request 和 response，這裡使用命名慣例寫法</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handler</span>(<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(req.url)  <span class="hljs-comment">// 印出 req 網址</span><br>  res.write(<span class="hljs-string">&#x27;Hello World!&#x27;</span>)   <span class="hljs-comment">// 指定 respone 回傳內容</span><br>  res.end()   <span class="hljs-comment">// 結束這個 response</span><br>&#125;<br><br><span class="hljs-comment">// 常見為 80 port，測試時使用 5001 port 就不易發生衝突</span><br>server.listen(<span class="hljs-number">5001</span>)<br></code></pre></td></tr></table></figure>

<p>接著在 CLI 介面執行 js 檔，會發現什麼事也沒發生，但其實我們已經成功運行一個 server，否則程式會直接執行結束：</p>
<p><img src="https://i.imgur.com/2Bv9WKj.png"></p>
<ol start="3">
<li>可以在瀏覽器輸入 <code>http://localhost:5001/</code>，連到本地端的 5001 port，就會看到回傳內容 <code>Hello World!</code>：</li>
</ol>
<p><img src="https://i.imgur.com/ZY79LWh.png"></p>
<p>或者我們也可以根據不同 url，來回傳不同內容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>)<br><span class="hljs-keyword">const</span> server = http.createServer(handler)<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handler</span>(<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(req.url)  <span class="hljs-comment">// 印出 req 網址</span><br>  <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">&#x27;/hello&#x27;</span>) &#123;<br>    <span class="hljs-comment">// 參數分別是 request 的 status code 和內容格式，告訴瀏覽器如何解析網頁</span><br>    res.writeHead(<span class="hljs-number">200</span>, &#123;            <span class="hljs-comment">// 200: 請求成功</span><br>      <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span><br>    &#125;)<br>    res.write(<span class="hljs-string">&#x27;&lt;h1&gt;hello!&lt;/h1&gt;&#x27;</span>)    <span class="hljs-comment">// 也可以加上 HTML 標籤</span><br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">&#x27;/bye&#x27;</span>) &#123;<br>    res.write(<span class="hljs-string">&#x27;bye!&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.write(<span class="hljs-string">&#x27;Invalid url&#x27;</span>)<br>  &#125;<br>  res.end()   <span class="hljs-comment">// 結束這個 response</span><br>&#125;<br><br>server.listen(<span class="hljs-number">5001</span>)<br></code></pre></td></tr></table></figure>

<p>在瀏覽器運行結果如下，瀏覽器會根據內容格式（Content-Type）解析網頁：</p>
<p><img src="https://i.imgur.com/LbCRc8S.png"></p>
<p>而當我們切換網址時，CLI 介面也會印出 url 文字，其中 <code>/favicon.ico</code> 代表瀏覽器標籤的 logo：</p>
<p><img src="https://i.imgur.com/t5Gx1JF.png"></p>
<p>我們也可以利用 <code>res.writeHead()</code> 來導向其他網址，如下方範例。這時如果輸入 <code>http://localhost:5001/bye</code>，就會重新導向至 google 首頁：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>)<br><span class="hljs-keyword">const</span> server = http.createServer(handler)<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handler</span>(<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(req.url)  <span class="hljs-comment">// 印出 req 網址</span><br>  <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">&#x27;/hello&#x27;</span>) &#123;<br>    res.write(<span class="hljs-string">&#x27;&lt;h1&gt;hello!&lt;/h1&gt;&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">&#x27;/bye&#x27;</span>) &#123;<br>    res.writeHead(<span class="hljs-number">301</span>, &#123;              <span class="hljs-comment">// 301: 重新導向</span><br>      <span class="hljs-string">&#x27;Location&#x27;</span>: <span class="hljs-string">&#x27;https://www.google.com.tw/&#x27;</span><br>    &#125;)<br>    res.write(<span class="hljs-string">&#x27;bye!&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.write(<span class="hljs-string">&#x27;Invalid url&#x27;</span>)<br>  &#125;<br>  res.end()   <span class="hljs-comment">// 結束這個 response</span><br>&#125;<br><br>server.listen(<span class="hljs-number">5001</span>)<br></code></pre></td></tr></table></figure>

<p>根據上述範例，我們能夠利用 Node.js 提供的模組，來實作出一個簡易的 http server。</p>
<p>其實這不是本單元要討論的重點，只是藉由範例來瞭解，Node.js 的底層就是利用 <code>http.createServer()</code> 來執行，即使不透過 Library 也能夠時做出 server。</p>
<p>瞭解到背後運作的原理後，接下來要介紹另一套 Library，其實就是把上面實作的功能包裝在一起，讓我們能更方便取得資料。</p>
<h2 id="初探-Express"><a href="#初探-Express" class="headerlink" title="初探 Express"></a>初探 Express</h2><p>什麼是 Express？根據<a href="(https://expressjs.com/)">官網</a>介紹：</p>
<blockquote>
<p>Express: Fast, unopinionated, minimalist web framework for Node.js</p>
</blockquote>
<p>簡言之，Express 是 Node.js 環境下提供的一個輕量後端框架，自由度極高，透過豐富的 HTTP 工具，能幫助快速開發後端應用程式。</p>
<p>跟其他有完整 MVC 架構的框架相比，Express 其實鬆散（或者說自由）很多，許多地方並沒有強制規範，都只是按照前人的方法或者是慣例來實踐，十個人可能會有十種不同的寫法。</p>
<h3 id="安裝-Express"><a href="#安裝-Express" class="headerlink" title="安裝 Express"></a>安裝 Express</h3><blockquote>
<p>詳細步驟可參考<span class="exturl" data-url="aHR0cHM6Ly9leHByZXNzanMuY29tL3poLXR3L3N0YXJ0ZXIvaW5zdGFsbGluZy5odG1s">官方文件<i class="fa fa-external-link-alt"></i></span>。</p>
</blockquote>
<h4 id="Step1-初始化-npm，過程都按確定，最後會在資料夾中建立一個-package-json-檔"><a href="#Step1-初始化-npm，過程都按確定，最後會在資料夾中建立一個-package-json-檔" class="headerlink" title="Step1. 初始化 npm，過程都按確定，最後會在資料夾中建立一個 package.json 檔"></a>Step1. 初始化 npm，過程都按確定，最後會在資料夾中建立一個 package.json 檔</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">$ <span class="hljs-built_in">npm</span> init<br></code></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/Ya0XugX.png"></p>
<h4 id="Step2-安裝-Express"><a href="#Step2-安裝-Express" class="headerlink" title="Step2. 安裝 Express"></a>Step2. 安裝 Express</h4><p>在最新的 npm 版本，可以省略 <code>--save</code>，安裝完成還是會自動存到 package.json：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">$ npm install <span class="hljs-built_in">express</span> --<span class="hljs-built_in">save</span><br></code></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/qOagjRg.png"></p>
<h4 id="Step3-實作範例：Hello-world"><a href="#Step3-實作範例：Hello-world" class="headerlink" title="Step3. 實作範例：Hello world"></a>Step3. 實作範例：Hello world</h4><p>接著可以跟著<span class="exturl" data-url="aHR0cHM6Ly9leHByZXNzanMuY29tL2VuL3N0YXJ0ZXIvaGVsbG8td29ybGQuaHRtbA==">官方文件<i class="fa fa-external-link-alt"></i></span>來實作一個簡單範例，開啟 index.js 檔並輸入下列程式碼：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入 library</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-comment">// express 引入的是一個 function</span><br><span class="hljs-keyword">const</span> app = express();<br><span class="hljs-comment">// 建立一個不易產生衝突的 port 用來測試</span><br><span class="hljs-keyword">const</span> port = <span class="hljs-number">5001</span>;<br><br><span class="hljs-comment">// 如何處理不同的 request，參數分別為 url 和要執行的 function</span><br>app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.send(<span class="hljs-string">&#x27;hello world!&#x27;</span>)<br>&#125;)<br><br>app.get(<span class="hljs-string">&#x27;/bye&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.send(<span class="hljs-string">&#x27;bye!&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// 運行這個 port，參數分別為 port 和要執行的 function</span><br>app.listen(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening at http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>在 CLI 介面執行 index.js，出現下方文字代表有成功運行程式：</p>
<p><img src="https://i.imgur.com/VG4okLU.png"></p>
<p>這時在瀏覽器輸入 <code>http://localhost:5001/</code>，就會看到回傳內容：</p>
<p><img src="https://i.imgur.com/NYQmfRF.png"></p>
<p>如果發現修改後，網頁還是會導回先前設定的網址，可透過開發者工具來清除快取（cache），重整頁面就能看到結果：</p>
<p><img src="https://i.imgur.com/6T6umyx.png"></p>
<p>和最一開始的範例做比較的話，其實可以發現到，寫法和使用 Node.js 實作 Server 非常類似。</p>
<p>但是藉由 Express 提供的<span class="exturl" data-url="aHR0cHM6Ly9leHByZXNzanMuY29tL3poLXR3L2d1aWRlL3JvdXRpbmcuaHRtbA==">路由（Routing）<i class="fa fa-external-link-alt"></i></span>系統，會將許多語法包裝好，在執行上也會方便許多。除了 <code>app.get()</code>，還有像是 <code>app.post()</code> 和 <code>app.delete()</code> 等針對不同 method 來進行操作，這部分我們後面會再詳細介紹。</p>
<h3 id="Express-vs-Apache-PHP"><a href="#Express-vs-Apache-PHP" class="headerlink" title="Express vs Apache + PHP"></a>Express vs Apache + PHP</h3><p>在看完上面的範例後，我們可以試著比較 Express 和以前所學的 <span class="exturl" data-url="aHR0cHM6Ly9oYWNrbWQuaW8vQEhlaWRpLUxpdS9ub3RlLWJlMTAxLXBocC1hbmQtbXlzcWw=">Apache + PHP<i class="fa fa-external-link-alt"></i></span>，兩者的運作模式有何差別：</p>
<h4 id="Apache-PHP"><a href="#Apache-PHP" class="headerlink" title="Apache + PHP"></a>Apache + PHP</h4><ul>
<li>瀏覽器會發 request 給 Apache Server，再交給 PHP 處理，處理完成後再傳 response 回去</li>
<li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLXR3LyVFNiU5NiU4NyVFNCVCQiVCNiVFNyVCMyVCQiVFNyVCQiU5Rg==">檔案系統<i class="fa fa-external-link-alt"></i></span>：預設路徑長什麼樣子，在該資料夾底下就會有對應的 php 檔</li>
</ul>
<p><img src="https://i.imgur.com/EYfvLe0.png"></p>
<h4 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h4><ul>
<li>瀏覽器發 request 給 Express Server，經過處理後會根據 url 回傳 response</li>
<li>和前者的最大差別，就是沒有 PHP 處理器，Express 本身就是一個 Server，透過路由系統決定什麼路徑回傳什麼資料，而不會侷限在檔案系統</li>
</ul>
<p><img src="https://i.imgur.com/zXWH67g.png"></p>
<h2 id="MVC-基本架構"><a href="#MVC-基本架構" class="headerlink" title="MVC 基本架構"></a>MVC 基本架構</h2><p>在課程當中，我們會使用後端框架 Express 和 ORM 工具 Sequelize 來打造 MVC 架構的網站，以下先來談談什麼是 MVC 架構。</p>
<p>MVC（Model–view–controller）：是一種應用程式架構，透過將程式碼拆成分成模型（Model）、視圖（View）和控制器（Controller）三個部分，並透過路由系統，建立整個應用程式的設計模式。</p>
<p>在 MVC 架構中，request 流程大致如下：</p>
<ol>
<li>發出的 request 會由 Controller 來處理</li>
<li>接著 Controller 會和 Model 拿取 data</li>
<li>Controller 再把拿到的資料給 View，由 View 提供的 template</li>
<li>最後 Controller 再結合 data 和 template，回傳 response</li>
</ol>
<p><img src="https://i.imgur.com/aYBYHlx.png"></p>
<p>簡單來說：</p>
<ul>
<li>Model 負責處理資料部分（data），例如在 MySQL 資料庫裡建立 tables，以及所有讀取、寫入資料等</li>
<li>View 負責處理畫面的部分（template），也就是我們看到的網頁內容</li>
<li>Controller 在過程中扮演 Model 和 View 中間的協調者，當不同路由（route）接收到 request 時，會呼叫 Controller 執行相對應的 Method。例如跟 Model 拿取資料，結合 View 提供的模版之後，再回傳 response</li>
</ul>
<p>這和我們之前使用 PHP 寫的網頁相比，在分工上是明確許多的。接下來我們要利用 Nodes.js 來實作一個簡單的 MVC 架構。</p>
<h2 id="在-Node-js-上實作-MVC-架構"><a href="#在-Node-js-上實作-MVC-架構" class="headerlink" title="在 Node.js 上實作 MVC 架構"></a>在 Node.js 上實作 MVC 架構</h2><h3 id="透過-Express-提供的-template-engines-來實作-View"><a href="#透過-Express-提供的-template-engines-來實作-View" class="headerlink" title="透過 Express 提供的 template engines 來實作 View"></a>透過 Express 提供的 <span class="exturl" data-url="aHR0cHM6Ly9leHByZXNzanMuY29tL2VuL2d1aWRlL3VzaW5nLXRlbXBsYXRlLWVuZ2luZXMuaHRtbA==">template engines<i class="fa fa-external-link-alt"></i></span> 來實作 View</h3><ol>
<li>選擇安裝一種 template engines（樣板處理器）使用，這裡以 EJS 做為範例，架構類似於之前學過的 PHP：</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">$ npm <span class="hljs-keyword">install</span> ejs<br></code></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/DixdfOM.png"></p>
<ul>
<li>EJS 語法是透過 <code>&lt;%  %&gt;</code> 符號，和 PHP 語法其實很類似，語法又可分為三種：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;% JavaScript 程式碼 %&gt;<br><br>&lt;%-  %&gt; 會經過解析然後印出來，用於引入 HTML 內容<br><br>&lt;%=  %&gt; 會直接印出原始碼，用於輸出資料，避免被解析成語法，可視為一種 XSS 防禦<br><br><span class="hljs-comment">// 可和 PHP 寫法做比較</span><br>&lt;?PHP echo   ?&gt; <br></code></pre></td></tr></table></figure>

<ol start="2">
<li>接著回到剛才的 index.js 檔，加上 <code>app.set()</code> 設定要使用的 view engine：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 設定 view engine</span><br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><p>預設目錄會是 <code>/views</code>，因此需要新建一個資料夾 views，並在資料夾中建立一個 hello.ejs 檔</p>
</li>
<li><p>記得在 VS Code 等編譯器中安裝 ejs 插件，才能夠解析 ejs 檔：<br><img src="https://i.imgur.com/PVJjWAG.png"></p>
</li>
<li><p>在 hello.ejs 檔中輸入簡單的程式碼進行測試，例如：<code>&lt;h1&gt;hello&lt;/h1&gt;</code></p>
</li>
<li><p>接著調整 index.js 程式碼，告訴 express 去 render views 目錄底下叫做 hello 的檔案：</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = express();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">5001</span>;<br><br><span class="hljs-comment">// 設定 view engine</span><br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br><br>app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.send(<span class="hljs-string">&#x27;index&#x27;</span>)<br>&#125;)<br><br>app.get(<span class="hljs-string">&#x27;/hello&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><span class="hljs-comment">// 叫 express 去 render views 底下叫做 hello 的檔案，副檔名可省略</span><br>  res.render(<span class="hljs-string">&#x27;hello&#x27;</span>)<br>&#125;)<br><br>app.listen(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening at http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<ol start="7">
<li>輸入 node index.js 指令運行，在瀏覽器可以看到結果：</li>
</ol>
<p><img src="https://i.imgur.com/G32u0NI.png"></p>
<ol start="8">
<li>如果想要修改 views 中的 template，也就是 ejs 檔的內容，只要重整瀏覽器畫面即可，不需再重新運行 Node.js：</li>
</ol>
<p><img src="https://i.imgur.com/dKhAwTu.png"></p>
<h3 id="實作簡易的-todo-list-API"><a href="#實作簡易的-todo-list-API" class="headerlink" title="實作簡易的 todo list API"></a>實作簡易的 todo list API</h3><ol>
<li>首先在 index.js 建立 todos，並設定 app.get() 傳入資料：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = express();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">5001</span>;<br><br><span class="hljs-comment">// 設定 view engine</span><br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br><br><span class="hljs-comment">// 建立 todos data</span><br><span class="hljs-keyword">const</span> todos = [<br>  <span class="hljs-string">&#x27;first todo&#x27;</span>, <span class="hljs-string">&#x27;second todo&#x27;</span>, <span class="hljs-string">&#x27;third todo&#x27;</span><br>]<br><br>app.get(<span class="hljs-string">&#x27;/todos&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 第二個參數可傳入資料</span><br>  res.render(<span class="hljs-string">&#x27;todos&#x27;</span>, &#123;<br>    todos     <span class="hljs-comment">// todos: todos 一樣的話可省略寫法</span><br>  &#125;)<br>&#125;)<br><br>app.get(<span class="hljs-string">&#x27;/hello&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.render(<span class="hljs-string">&#x27;hello&#x27;</span>)<br>&#125;)<br><br>app.listen(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening at http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>接著編輯 todos.ejs 檔的內容，也就是 todos 的 view 部分。要輸出內容的語法是 <code>&lt;%= code %&gt;</code>，而不是用 console.log()，或是 PHP 的 echo：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;h1&gt;Todos&lt;/h1&gt;<br><br>&lt;ul&gt;<br>&lt;% <span class="hljs-function"><span class="hljs-title">for</span>(<span class="hljs-params"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; todos.length; i++</span>)</span> &#123; %&gt;<br>  &lt;li&gt;&lt;%= todos[i]%&gt;&lt;<span class="hljs-regexp">/li&gt;    /</span><span class="hljs-regexp">/ 加上等於代表後面的東西要輸出</span><br><span class="hljs-regexp">&lt;% &#125; %&gt;</span><br><span class="hljs-regexp">&lt;/u</span>l&gt;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>在瀏覽器運行，這樣能根據之前設立的 data 輸出 todos：</li>
</ol>
<p><img src="https://i.imgur.com/zGLAWIT.png"></p>
<ol start="4">
<li>接著回到 index.js 檔，用同樣的方式，根據不同 id 來拿取對應的 todo：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 加上 :id 代表不確定的參數</span><br>app.get(<span class="hljs-string">&#x27;/todos/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// params: 可拿到網址列上指定的參數</span><br>  <span class="hljs-keyword">const</span> id = req.params.id<br>  <span class="hljs-keyword">const</span> todo = todos[id]<br>  res.render(<span class="hljs-string">&#x27;todo&#x27;</span>, &#123;<br>    todo<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>建立 todo.ejs 檔，也就是 todo 的 view 部分：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;h1&gt;Todo&lt;/h1&gt;<br><br>&lt;h2&gt;&lt;%= todo %&gt;&lt;/h2&gt;<br></code></pre></td></tr></table></figure>

<ol start="6">
<li>透過網址列上的 id，能夠讀取相對應的 todo：</li>
</ol>
<p><img src="https://i.imgur.com/crYUBSj.png"></p>
<p>這樣就透過 Express 結合 view template engine 完成了簡單的範例，也可以再增加 header 或 footer 等來豐富內容。</p>
<h3 id="重構專案：實作-Model-amp-Controller"><a href="#重構專案：實作-Model-amp-Controller" class="headerlink" title="重構專案：實作 Model &amp; Controller"></a>重構專案：實作 Model &amp; Controller</h3><p>接下來要試著重構程式碼，也就是實作 MVC 架構中的 Model 和 Controller 部分。</p>
<h4 id="Model：用來管理-todos-的資料"><a href="#Model：用來管理-todos-的資料" class="headerlink" title="Model：用來管理 todos 的資料"></a>Model：用來管理 todos 的資料</h4><ol>
<li>回到 express 目錄，新增一個 models 資料夾，並在裡面建立 todo.js 檔</li>
<li>在 todo.js 檔案，建立 todoModel，提供存取資料的方法（function），例如 get 或 add 等 method：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> todos = [<br>  <span class="hljs-string">&#x27;first todo&#x27;</span>, <span class="hljs-string">&#x27;second todo&#x27;</span>, <span class="hljs-string">&#x27;third todo&#x27;</span><br>]<br><br><span class="hljs-comment">// 建立一個 todoModel 物件，裡面放存取資料的方法（function）</span><br><span class="hljs-keyword">const</span> todoModel = &#123;<br>  getAll: <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> todos<br>  &#125;,<br><br>  get: <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> todos[id]<br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = todoModel<br></code></pre></td></tr></table></figure>

<h4 id="Controller：控制器"><a href="#Controller：控制器" class="headerlink" title="Controller：控制器"></a>Controller：控制器</h4><ol>
<li>同樣在 express 目錄，新增一個 controllers 資料夾，並在裡面建立 todo.js 檔</li>
<li>接著重構程式碼：</li>
</ol>
<ul>
<li>從 model 引入資料</li>
<li>建立物件，並透過方法（function）來存取資料，這裡會和一開始中 index.js 的 app.get() 寫法類似</li>
<li>再交由 view engine 進行 render</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 先從 model 引入 todos 資料</span><br><span class="hljs-keyword">const</span> todoModel = <span class="hljs-built_in">require</span>(../models/todo)<br><br><span class="hljs-comment">// 建立一個 todoController 物件，透過方法來存取 model 的資料</span><br><span class="hljs-keyword">const</span> todoController = &#123;<br>  <span class="hljs-comment">// 傳入參數 req, res</span><br>  getAll: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> todos = todoModel.getAll()<br>    res.render(<span class="hljs-string">&#x27;todos&#x27;</span>, &#123;<br>      todos<br>    &#125;)<br>  &#125;,<br><br>  get: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> id = req.params.id<br>    <span class="hljs-keyword">const</span> todo = todoModel.get(id)<br>    res.render(<span class="hljs-string">&#x27;todo&#x27;</span>, &#123;<br>      todo<br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = todoController<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>回到根目錄的 index.js 檔，修改路由，透過引入 controller 的 todo.js，程式碼就可以更簡潔：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = express();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">5001</span>;<br><br><span class="hljs-comment">// 引入 controller</span><br><span class="hljs-keyword">const</span> todoController = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./controllers/todo&#x27;</span>)<br><br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br><br><span class="hljs-keyword">const</span> todos = [<br>  <span class="hljs-string">&#x27;first todo&#x27;</span>, <span class="hljs-string">&#x27;second todo&#x27;</span>, <span class="hljs-string">&#x27;third todo&#x27;</span><br>]<br><br><span class="hljs-comment">// 可直接使用 controller 的方法拿取資料和進行 render</span><br>app.get(<span class="hljs-string">&#x27;/todos&#x27;</span>, todoController.getAll)<br><br>app.get(<span class="hljs-string">&#x27;/todos/:id&#x27;</span>,<br></code></pre></td></tr></table></figure>

<p>這樣就完成了有 MCV 架構的程式：</p>
<ul>
<li>express 目錄的 index.js：提供路由</li>
<li>views 目錄的 todo.ejs 和 todos.ejs：提供模版</li>
<li>models 目錄的 todo.js：提供資料</li>
<li>controllers 目錄的 todo.js：結合 model 和 view，根據路由回傳 Response</li>
</ul>
<p>假如是大型專案，可以更進一步簡化程式碼，例如把 index.js 中的 app 部分再獨立到專門管理路由的檔案，這部分我們之後會再介紹到。</p>
<h2 id="串接-Node-js-與-MySQL"><a href="#串接-Node-js-與-MySQL" class="headerlink" title="串接 Node.js 與 MySQL"></a>串接 Node.js 與 MySQL</h2><p>在瞭解到基本的 Express 架構之後，再來我們要試著把  todo 資料存在資料庫。這是因為在實際專案中，後端會把資料存放在資料庫，因此我們要來學習如何透過 Node.js 和 MySQL 溝通。</p>
<blockquote>
<p>注意不是用 Express 和 MySQL 溝通！我們要操作的是 Nodes.js，Express 提供的是框架！</p>
</blockquote>
<h3 id="Step1-安裝-MySQL"><a href="#Step1-安裝-MySQL" class="headerlink" title="Step1. 安裝 MySQL"></a>Step1. 安裝 MySQL</h3><p>在使用 Node.js 操作 MySQL 資料庫時，必須先安裝 MySQL 模組。搜尋 node.js mysql 會找到 GitHub 有個叫做 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL215c3FsanMvbXlzcWw=">mysqljs 的 Library<i class="fa fa-external-link-alt"></i></span>，執行安裝指令：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">$ npm <span class="hljs-keyword">install</span> mysql<br></code></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/tR8kezb.png"></p>
<p>引入 MySQL 模組後，接著就可以進行資料庫的連線和其他操作了。</p>
<h3 id="Step2-新增-app-資料庫-amp-todos-資料表"><a href="#Step2-新增-app-資料庫-amp-todos-資料表" class="headerlink" title="Step2. 新增 app 資料庫 &amp;  todos 資料表"></a>Step2. 新增 app 資料庫 &amp;  todos 資料表</h3><p>之前在<span class="exturl" data-url="aHR0cHM6Ly9oYWNrbWQuaW8vQEhlaWRpLUxpdS9ub3RlLWJlMTAxLXBocC1hbmQtbXlzcWw=">第九週學到如何使用 MySQL 資料庫<i class="fa fa-external-link-alt"></i></span>，這一次我們同樣可以透過 phpmyadmin 這個 GUI 介面來進行資料庫 CURD，步驟如下：</p>
<ol>
<li>開啟 XAMPP 連線 MySQL，其實這樣就已經啟動資料庫了，但如果要使用 phpmyadmin 介面操作，就必須同時運行 Apache Server 才能使用：</li>
</ol>
<p><img src="https://i.imgur.com/kCpCApB.png"></p>
<ol start="2">
<li>接著建立一個 app database，並在裡面新增一個 todos table</li>
</ol>
<p><img src="https://i.imgur.com/Flh0kkx.png"></p>
<ol start="3">
<li>在 todos table 新增幾筆資料</li>
</ol>
<p><img src="https://i.imgur.com/Bd9TEJB.png"></p>
<h3 id="Step3-串接-MySQL-資料庫"><a href="#Step3-串接-MySQL-資料庫" class="headerlink" title="Step3. 串接 MySQL 資料庫"></a>Step3. 串接 MySQL 資料庫</h3><p>確認本地端已經安裝資料庫並正常啟動，接著就可以新增一個 db.js 檔來進行連線，程式碼可<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL215c3FsanMvbXlzcWwjaW50cm9kdWN0aW9u">參考範例<i class="fa fa-external-link-alt"></i></span>：</p>
<blockquote>
<p>要等待回傳一定是使用 callback，好處就是從同步變成非同步。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入 mysql 模組</span><br><span class="hljs-keyword">var</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mysql&#x27;</span>);<br><span class="hljs-comment">// 建立連線</span><br><span class="hljs-keyword">var</span> connection = mysql.createConnection(&#123;<br>  host: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>  user: <span class="hljs-string">&#x27;root&#x27;</span>,<br>  password: <span class="hljs-string">&#x27;root&#x27;</span>,<br>  database: <span class="hljs-string">&#x27;app&#x27;</span><br>&#125;);<br><br>connection.connect();<br><span class="hljs-comment">// 使用 callback 來接收訊息: 連線成功就印出 todos 所有欄位</span><br>connection.query(<span class="hljs-string">&#x27;SELECT * from todos&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, results, fields</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;<br>  <span class="hljs-built_in">console</span>.log(results);<br>&#125;);<br><br>connection.end();<br></code></pre></td></tr></table></figure>

<p>接著在 CLI 介面執行 <code>node db.js</code>，如果有輸出資料就代表連線成功！</p>
<p><img src="https://i.imgur.com/UKf0NJ7.png"></p>
<p>其中 RowDataPacket 是一種自訂的資料格式，如果把 <code>console.log(results);</code> 改成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">console</span>.log(results[<span class="hljs-number">0</span>].content);<br></code></pre></td></tr></table></figure>

<p>就會達到拿到第一個 todo 的內容：</p>
<p><img src="https://i.imgur.com/M9sO5ZS.png"></p>
<h3 id="補充：權限不足問題"><a href="#補充：權限不足問題" class="headerlink" title="補充：權限不足問題"></a>補充：權限不足問題</h3><p>其實自己當初在嘗試連線資料庫時，有出現權限錯誤的訊息：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Error: ER_ACCESS_DENIED_ERROR: Access denied <span class="hljs-keyword">for</span><span class="hljs-built_in"> user </span><span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> (using passwo<br>rd: <span class="hljs-literal">YES</span>)<br></code></pre></td></tr></table></figure>

<p>後來是在使用者帳號頁面發現，root 這組帳號當初設定不用密碼就可以登入了，真是烏龍一場XD</p>
<p><img src="https://i.imgur.com/KGhvnqv.png"></p>
<h3 id="Step4-重構程式碼"><a href="#Step4-重構程式碼" class="headerlink" title="Step4. 重構程式碼"></a>Step4. 重構程式碼</h3><ol>
<li>將 db.js 簡化，獨立成串聯資料庫時需要的資料，方便其他部分要連線時引入：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mysql&#x27;</span>);<br><span class="hljs-keyword">var</span> connection = mysql.createConnection(&#123;<br>  host: <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>  user: <span class="hljs-string">&#x27;root&#x27;</span>,<br>  password: <span class="hljs-string">&#x27;root&#x27;</span>,<br>  database: <span class="hljs-string">&#x27;app&#x27;</span><br>&#125;);<br><br><span class="hljs-built_in">module</span>.exports = connection;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>接著在 index.js 引入 db，也就是 mysql 模組以及連線資料，加上 <code>db.connect()</code> 指令來連線：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-comment">// 引入 db 資料庫: mysql 模組 &amp; 連線資料</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./db&#x27;</span>)<br><span class="hljs-keyword">const</span> app = express();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">5001</span>;<br><br><span class="hljs-keyword">const</span> todoController = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./controllers/todo&#x27;</span>)<br><br>app.set(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br><br>app.get(<span class="hljs-string">&#x27;/todos&#x27;</span>, todoController.getAll)<br>app.get(<span class="hljs-string">&#x27;/todos/:id&#x27;</span>, todoController.get)<br><br>app.listen(port, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 連線資料庫</span><br>  db.connect()<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Example app listening at http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>再來是修改 Models，MVC 架構的好處就是能像這樣明確分工：</li>
</ol>
<blockquote>
<p>在使用 SQL 指令時須注意，字串拼接可能會有 SQL injection 的風險，可透過 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL215c3FsanMvbXlzcWwjcHJlcGFyaW5nLXF1ZXJpZXM=">Preparing Queries<i class="fa fa-external-link-alt"></i></span> 來避免，方法和 Prepared Statements 其實很類似。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入 db，也就是 connection</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../db&#x27;</span>)<br><br><span class="hljs-keyword">const</span> todoModel = &#123;<br>  <span class="hljs-comment">// 這裡要用 callback 來拿取資料</span><br>  getAll: <span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span> &#123;<br>    db.query(<br>      <span class="hljs-string">&#x27;SELECT * FROM todos&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> cb(err);<br>      <span class="hljs-comment">// cb: 第一個參數為是否有錯誤，沒有的話就是 null，第二個才是結果</span><br>      cb(<span class="hljs-literal">null</span>, results)<br>    &#125;);<br>  &#125;,<br><br>  get: <span class="hljs-function">(<span class="hljs-params">id, cb</span>) =&gt;</span> &#123;<br>    db.query(<br>      <span class="hljs-string">&#x27;SELECT * FROM todos WHERE id = ?&#x27;</span>, [id], <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> cb(err);<br>        cb(<span class="hljs-literal">null</span>, results)<br>      &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = todoModel<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>因為 Models 從同步改成非同步操作，也要修改 Controllers 的部分：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 先從 model 引入 todos 資料</span><br><span class="hljs-keyword">const</span> todoModel = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../models/todo&#x27;</span>)<br><br><span class="hljs-keyword">const</span> todoController = &#123;<br>  getAll: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 改成 callback 非同步操作</span><br>    todoModel.getAll(<span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 如果有 err 就印出錯誤訊息</span><br>      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(err);<br>      <span class="hljs-comment">// 不然就把 todos 傳給 view</span><br>      res.render(<span class="hljs-string">&#x27;todos&#x27;</span>, &#123;<br>        todos: results<br>      &#125;)<br>    &#125;)<br>  &#125;,<br><br>  get: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> id = req.params.id<br>    todoModel.get(id, <span class="hljs-function">(<span class="hljs-params">err, results</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.log(err);<br>      res.render(<span class="hljs-string">&#x27;todos&#x27;</span>, &#123;<br>        <span class="hljs-comment">// 注意回傳的結果 array，必須取 results[0] 才會是一個 todo</span><br>        todos: results[<span class="hljs-number">0</span>]<br>      &#125;)<br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">module</span>.exports = todoController<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>再來是修改 Views 部分，Todos 部分有兩種寫法：</li>
</ol>
<ul>
<li>第一種：分開寫</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;h1&gt;Todos&lt;/h1&gt;<br><br>&lt;ul&gt;<br>&lt;% <span class="hljs-function"><span class="hljs-title">for</span>(<span class="hljs-params"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; todos.length; i++</span>)</span> &#123; %&gt;<br>  &lt;li&gt;&lt;%= todos[i].id %&gt;: &lt;%= todos[i].content %&gt;&lt;/li&gt;<br>&lt;% &#125; %&gt;<br>&lt;/ul&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>第二種：寫在一起，用字串拼接方式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;h1&gt;Todos&lt;/h1&gt;<br><br>&lt;ul&gt;<br>&lt;% <span class="hljs-function"><span class="hljs-title">for</span>(<span class="hljs-params"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; todos.length; i++</span>)</span> &#123; %&gt;<br>  &lt;li&gt;&lt;%= todos[i].id + <span class="hljs-string">&#x27;: &#x27;</span> + todos[i].content %&gt;&lt;/li&gt;<br>&lt;% &#125; %&gt;<br>&lt;/ul&gt;<br></code></pre></td></tr></table></figure>

<p>執行 <code>node index.js</code> 之後，回到瀏覽器確認程式是否有成功運行：</p>
<blockquote>
<p>這裡 port 之所以變成 5002，是因為前面在嘗試修改連線時，不知在哪個環節佔用了 5001，因此先改成另一個沒有使用的 port</p>
</blockquote>
<p><img src="https://i.imgur.com/aSpv3e4.png"></p>
<p>接著是 Todo，會發現輸出結果是 Object。這是因為 <code>&lt;%= %&gt;</code> 語法會直接印出字串，當我們想要把一個 Object 轉成字串時，就會發生下列情形：</p>
<p><img src="https://i.imgur.com/WMopGth.png"></p>
<p>只要將 Todo 部分修改成輸出 <code>todo.content</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;h1&gt;Todo&lt;/h1&gt;<br><br>&lt;h2&gt;&lt;%= todo.content %&gt;&lt;/h2&gt;<br></code></pre></td></tr></table></figure>

<p>結果就會是相對應的 todo：</p>
<p><img src="https://i.imgur.com/02Wnbnb.png"></p>
<p>如果對資料庫操作 CURD，重整頁面也會動態更新：</p>
<p><img src="https://i.imgur.com/NZ0Hzj3.png"></p>
<p>學到目前為止，透過上面這些範例，我們其實已經能寫出一些簡單的網頁程式了，並且有 MVC 架構，能夠簡化程式碼且便於維護。</p>
<hr>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>其實官網上的教學都已經蠻清楚了，但還是想跟著課程影片一步一步操作，一方面透過實作，發現可能會遇到哪些問題，一方面也能加深印象，讓自己更快去熟悉 Express 這套新工具。</p>
<p>也透過實作來複習之前講解過的 MVC 框架，透過將程式碼分成 Model、View 和 Controller 三個部分，再搭配不同 Route 分別進行處理，不但能夠簡化程式碼，也能透過分工便於後續維護。</p>
<p>參考資料：</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9jeXRoaWx5YS5naXRodWIuaW8vMjAxNC8xMS8yMy9ub2RlanMtZXhwcmVzcy1taWNyb2Jsb2cv">使用 Node.js + Express 建構一個簡單的微博網站<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9uaWNvbGFrYWNoYS5jb2RlcmJyaWRnZS5pby8yMDIwLzEwLzI1L2V4cHJlc3MtbXZjLXByYWN0aWNlLTEv">用 Express &amp; Sequelize 打造 MVC 餐廳網站（上）<i class="fa fa-external-link-alt"></i></span></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Back-End/" rel="tag"># Back-End</a>
              <a href="/tags/Express/" rel="tag"># Express</a>
              <a href="/tags/Node-js/" rel="tag"># Node.js</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/js201-hw/" rel="prev" title="[week 16] JavaScript 進階 - 作業練習">
      <i class="fa fa-chevron-left"></i> [week 16] JavaScript 進階 - 作業練習
    </a></div>
      <div class="post-nav-item">
    <a href="/be201-express-middleware/" rel="next" title="[week 17] 後端中階 - Express 中不可或缺的拼圖：淺談 Middleware">
      [week 17] 後端中階 - Express 中不可或缺的拼圖：淺談 Middleware <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
          <div style="">
            
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

          </div>
        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A6%81%E5%AD%B8%E6%A1%86%E6%9E%B6%EF%BC%8C%E5%85%88%E5%BE%9E%E4%B8%8D%E7%94%A8%E6%A1%86%E6%9E%B6%E9%96%8B%E5%A7%8B"><span class="nav-number">1.</span> <span class="nav-text">要學框架，先從不用框架開始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%9A%E4%BB%A5-Node-js-%E5%AF%A6%E4%BD%9C%E4%B8%80%E5%80%8B-Server"><span class="nav-number">1.1.</span> <span class="nav-text">範例：以 Node.js 實作一個 Server</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E6%8E%A2-Express"><span class="nav-number">2.</span> <span class="nav-text">初探 Express</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D-Express"><span class="nav-number">2.1.</span> <span class="nav-text">安裝 Express</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Step1-%E5%88%9D%E5%A7%8B%E5%8C%96-npm%EF%BC%8C%E9%81%8E%E7%A8%8B%E9%83%BD%E6%8C%89%E7%A2%BA%E5%AE%9A%EF%BC%8C%E6%9C%80%E5%BE%8C%E6%9C%83%E5%9C%A8%E8%B3%87%E6%96%99%E5%A4%BE%E4%B8%AD%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%80%8B-package-json-%E6%AA%94"><span class="nav-number">2.1.1.</span> <span class="nav-text">Step1. 初始化 npm，過程都按確定，最後會在資料夾中建立一個 package.json 檔</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Step2-%E5%AE%89%E8%A3%9D-Express"><span class="nav-number">2.1.2.</span> <span class="nav-text">Step2. 安裝 Express</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Step3-%E5%AF%A6%E4%BD%9C%E7%AF%84%E4%BE%8B%EF%BC%9AHello-world"><span class="nav-number">2.1.3.</span> <span class="nav-text">Step3. 實作範例：Hello world</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Express-vs-Apache-PHP"><span class="nav-number">2.2.</span> <span class="nav-text">Express vs Apache + PHP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Apache-PHP"><span class="nav-number">2.2.1.</span> <span class="nav-text">Apache + PHP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Express"><span class="nav-number">2.2.2.</span> <span class="nav-text">Express</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVC-%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%A7%8B"><span class="nav-number">3.</span> <span class="nav-text">MVC 基本架構</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-Node-js-%E4%B8%8A%E5%AF%A6%E4%BD%9C-MVC-%E6%9E%B6%E6%A7%8B"><span class="nav-number">4.</span> <span class="nav-text">在 Node.js 上實作 MVC 架構</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%8F%E9%81%8E-Express-%E6%8F%90%E4%BE%9B%E7%9A%84-template-engines-%E4%BE%86%E5%AF%A6%E4%BD%9C-View"><span class="nav-number">4.1.</span> <span class="nav-text">透過 Express 提供的 template engines 來實作 View</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%A6%E4%BD%9C%E7%B0%A1%E6%98%93%E7%9A%84-todo-list-API"><span class="nav-number">4.2.</span> <span class="nav-text">實作簡易的 todo list API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E6%A7%8B%E5%B0%88%E6%A1%88%EF%BC%9A%E5%AF%A6%E4%BD%9C-Model-amp-Controller"><span class="nav-number">4.3.</span> <span class="nav-text">重構專案：實作 Model &amp; Controller</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Model%EF%BC%9A%E7%94%A8%E4%BE%86%E7%AE%A1%E7%90%86-todos-%E7%9A%84%E8%B3%87%E6%96%99"><span class="nav-number">4.3.1.</span> <span class="nav-text">Model：用來管理 todos 的資料</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Controller%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">4.3.2.</span> <span class="nav-text">Controller：控制器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%B2%E6%8E%A5-Node-js-%E8%88%87-MySQL"><span class="nav-number">5.</span> <span class="nav-text">串接 Node.js 與 MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step1-%E5%AE%89%E8%A3%9D-MySQL"><span class="nav-number">5.1.</span> <span class="nav-text">Step1. 安裝 MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step2-%E6%96%B0%E5%A2%9E-app-%E8%B3%87%E6%96%99%E5%BA%AB-amp-todos-%E8%B3%87%E6%96%99%E8%A1%A8"><span class="nav-number">5.2.</span> <span class="nav-text">Step2. 新增 app 資料庫 &amp;  todos 資料表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step3-%E4%B8%B2%E6%8E%A5-MySQL-%E8%B3%87%E6%96%99%E5%BA%AB"><span class="nav-number">5.3.</span> <span class="nav-text">Step3. 串接 MySQL 資料庫</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%9C%E5%85%85%EF%BC%9A%E6%AC%8A%E9%99%90%E4%B8%8D%E8%B6%B3%E5%95%8F%E9%A1%8C"><span class="nav-number">5.4.</span> <span class="nav-text">補充：權限不足問題</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step4-%E9%87%8D%E6%A7%8B%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="nav-number">5.5.</span> <span class="nav-text">Step4. 重構程式碼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B5%90%E8%AA%9E"><span class="nav-number">6.</span> <span class="nav-text">結語</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Heidi Liu"
      src="https://avatars3.githubusercontent.com/u/65410665?s=460&u=887bd602944dcf78b90f3a880b03aec4e086728a&v=4">
  <p class="site-author-name" itemprop="name">Heidi Liu</p>
  <div class="site-description" itemprop="description">海底修羅場｜日々進化中</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hlaWRpbGl1MjAyMA==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;heidiliu2020"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9oZWlkaS1jb2RpbmcubWVkaXVtLmNvbS8=" title="Medium → https:&#x2F;&#x2F;heidi-coding.medium.com&#x2F;"><i class="fab fa-medium fa-fw"></i>Medium</span>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Heidi Liu</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Gemini</span> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='220,220,220' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

<script>
  var disqus_config = function() {
    this.page.url = "https://heidiliu2020.github.io/express/";
    this.page.identifier = "express/";
    this.page.title = "[week 17] 後端中階 - 使用 Node.js + Express 框架建立一個靜態網頁";
    this.language = "zh_TW"; 
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://heidiblog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

    </div>
</body>
</html>
